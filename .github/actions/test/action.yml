name: Test plexamp-tui Docker image
description: Run tests to verify the built app and Docker image work correctly

inputs:
  image-ref:
    description: 'Docker image reference to test'
    required: true

runs:
  using: composite
  steps:
    - name: Test app runs
      shell: bash -euo pipefail {0}
      run: |
        # Use `script` to allocate a pseudo-TTY so docker accepts `-t` even in CI.
        if ! raw_output="$(script -qfc "docker run -it --rm ${{ inputs.image-ref }} plexamp-tui --help" /dev/null)"; then
          echo "❌ Command failed to execute"
          exit 1
        fi
        output="${raw_output//$'\r'/}"
        if ! grep -q 'Usage' <<< "${output}"; then
          echo "❌ Unexpected output:"
          echo "${output}"
          exit 1
        fi
        echo "✅ Usage shown"
